#! /bin/sh
#
# Generate the content of the file 'version.hh'.
# 
# INPUT FILES 
#	VERSION	- file containing the version number
#
# STDOUT
#	The content to be put in the file 'version.hh'
#

set -e

VERSION="$(echo $(cat VERSION))"

if echo "$VERSION" | grep -qEv '[0-9]+\.[0-9]+\.[0-9]+' ; then
	echo >&2 "*** $0: Invalid version number '$VERSION'"
	exit 1
fi

VERSION_MAJOR="$(echo "$VERSION" | sed -e 's,^\([0-9][0-9]*\)\.[0-9][0-9]*\.[0-9][0-9]*$,\1,')"
VERSION_MINOR="$(echo "$VERSION" | sed -e 's,^[0-9][0-9]*\.\([0-9][0-9]*\)\.[0-9][0-9]*$,\1,')"
VERSION_PATCH="$(echo "$VERSION" | sed -e 's,^[0-9][0-9]*\.[0-9][0-9]*\.\([0-9][0-9]*\)$,\1,')"

echo "/* Automatically generated by $0 on $(date) */"
echo
echo '#ifndef VERSION_HH' 
echo '#define VERSION_HH' 
echo
echo '#define STU_VERSION' "\"$(cat VERSION)\"" 
echo
echo "#define STU_VERSION_MAJOR $VERSION_MAJOR"
echo "#define STU_VERSION_MINOR $VERSION_MINOR"
echo "#define STU_VERSION_PATCH $VERSION_PATCH"
echo 
echo '#endif /* ! VERSION_HH */' 
